{"version":3,"sources":["../../../next-server/server/load-components.ts"],"names":["interopDefault","mod","default","loadComponents","distDir","buildId","pathname","serverless","Component","getStaticProps","getStaticPaths","getServerSideProps","pageConfig","config","documentPath","SERVER_DIRECTORY","CLIENT_STATIC_FILES_PATH","appPath","DocumentMod","require","AppMod","ComponentMod","buildManifest","reactLoadableManifest","Document","App","Promise","all","BUILD_MANIFEST","REACT_LOADABLE_MANIFEST"],"mappings":"iHAAA,2CAMA,0BACA,kCAUO,QAASA,CAAAA,cAAT,CAAwBC,GAAxB,CAAkC,CACvC,MAAOA,CAAAA,GAAG,CAACC,OAAJ,EAAeD,GAAtB,CACD,CAuBM,cAAeE,CAAAA,cAAf,CACLC,OADK,CAELC,OAFK,CAGLC,QAHK,CAILC,UAJK,CAK8B,CACnC,GAAIA,UAAJ,CAAgB,CACd,KAAMC,CAAAA,SAAS,CAAG,KAAM,yBAAYF,QAAZ,CAAsBF,OAAtB,CAA+BG,UAA/B,CAAxB,CACA,KAAM,CAAEE,cAAF,CAAkBC,cAAlB,CAAkCC,kBAAlC,EAAyDH,SAA/D,CAEA,MAAO,CACLA,SADK,CAELI,UAAU,CAAEJ,SAAS,CAACK,MAAV,EAAoB,EAF3B,CAGLJ,cAHK,CAILC,cAJK,CAKLC,kBALK,CAAP,CAOD,CACD,KAAMG,CAAAA,YAAY,CAAG,eACnBV,OADmB,CAEnBW,2BAFmB,CAGnBC,mCAHmB,CAInBX,OAJmB,CAKnB,OALmB,CAMnB,WANmB,CAArB,CAQA,KAAMY,CAAAA,OAAO,CAAG,eACdb,OADc,CAEdW,2BAFc,CAGdC,mCAHc,CAIdX,OAJc,CAKd,OALc,CAMd,MANc,CAAhB,CASA,KAAMa,CAAAA,WAAW,CAAGC,OAAO,CAACL,YAAD,CAA3B,CAEA,KAAMM,CAAAA,MAAM,CAAGD,OAAO,CAACF,OAAD,CAAtB,CAEA,KAAMI,CAAAA,YAAY,CAAG,yBAAYf,QAAZ,CAAsBF,OAAtB,CAA+BG,UAA/B,CAArB,CAEA,KAAM,CACJe,aADI,CAEJC,qBAFI,CAGJf,SAHI,CAIJgB,QAJI,CAKJC,GALI,EAMF,KAAMC,CAAAA,OAAO,CAACC,GAAR,CAAY,CACpBR,OAAO,CAAC,eAAKf,OAAL,CAAcwB,yBAAd,CAAD,CADa,CAEpBT,OAAO,CAAC,eAAKf,OAAL,CAAcyB,kCAAd,CAAD,CAFa,CAGpB7B,cAAc,CAACqB,YAAD,CAHM,CAIpBrB,cAAc,CAACkB,WAAD,CAJM,CAKpBlB,cAAc,CAACoB,MAAD,CALM,CAAZ,CANV,CAcA,KAAM,CAAET,kBAAF,CAAsBF,cAAtB,CAAsCC,cAAtC,EAAyDW,YAA/D,CAEA,MAAO,CACLI,GADK,CAELD,QAFK,CAGLhB,SAHK,CAILc,aAJK,CAKLC,qBALK,CAMLX,UAAU,CAAES,YAAY,CAACR,MAAb,EAAuB,EAN9B,CAOLF,kBAPK,CAQLF,cARK,CASLC,cATK,CAAP,CAWD","sourcesContent":["import {\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  REACT_LOADABLE_MANIFEST,\n  SERVER_DIRECTORY,\n} from '../lib/constants'\nimport { join } from 'path'\nimport { requirePage } from './require'\nimport { BuildManifest } from './get-page-files'\nimport { AppType, DocumentType } from '../lib/utils'\nimport {\n  PageConfig,\n  GetStaticPaths,\n  GetServerSideProps,\n  GetStaticProps,\n} from 'next/types'\n\nexport function interopDefault(mod: any) {\n  return mod.default || mod\n}\n\nexport type ManifestItem = {\n  id: number | string\n  name: string\n  file: string\n  publicPath: string\n}\n\ntype ReactLoadableManifest = { [moduleId: string]: ManifestItem[] }\n\nexport type LoadComponentsReturnType = {\n  Component: React.ComponentType\n  pageConfig?: PageConfig\n  buildManifest: BuildManifest\n  reactLoadableManifest: ReactLoadableManifest\n  Document: DocumentType\n  App: AppType\n  getStaticProps?: GetStaticProps\n  getStaticPaths?: GetStaticPaths\n  getServerSideProps?: GetServerSideProps\n}\n\nexport async function loadComponents(\n  distDir: string,\n  buildId: string,\n  pathname: string,\n  serverless: boolean\n): Promise<LoadComponentsReturnType> {\n  if (serverless) {\n    const Component = await requirePage(pathname, distDir, serverless)\n    const { getStaticProps, getStaticPaths, getServerSideProps } = Component\n\n    return {\n      Component,\n      pageConfig: Component.config || {},\n      getStaticProps,\n      getStaticPaths,\n      getServerSideProps,\n    } as LoadComponentsReturnType\n  }\n  const documentPath = join(\n    distDir,\n    SERVER_DIRECTORY,\n    CLIENT_STATIC_FILES_PATH,\n    buildId,\n    'pages',\n    '_document'\n  )\n  const appPath = join(\n    distDir,\n    SERVER_DIRECTORY,\n    CLIENT_STATIC_FILES_PATH,\n    buildId,\n    'pages',\n    '_app'\n  )\n\n  const DocumentMod = require(documentPath)\n\n  const AppMod = require(appPath)\n\n  const ComponentMod = requirePage(pathname, distDir, serverless)\n\n  const [\n    buildManifest,\n    reactLoadableManifest,\n    Component,\n    Document,\n    App,\n  ] = await Promise.all([\n    require(join(distDir, BUILD_MANIFEST)),\n    require(join(distDir, REACT_LOADABLE_MANIFEST)),\n    interopDefault(ComponentMod),\n    interopDefault(DocumentMod),\n    interopDefault(AppMod),\n  ])\n\n  const { getServerSideProps, getStaticProps, getStaticPaths } = ComponentMod\n\n  return {\n    App,\n    Document,\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    pageConfig: ComponentMod.config || {},\n    getServerSideProps,\n    getStaticProps,\n    getStaticPaths,\n  }\n}\n"]}