{"version":3,"sources":["../../../next-server/server/send-payload.ts"],"names":["sendPayload","res","payload","type","options","setHeader","Buffer","byteLength","private","stateful","hasHeader","revalidate","Error","end"],"mappings":"qEACA,mCAEO,QAASA,CAAAA,WAAT,CACLC,GADK,CAELC,OAFK,CAGLC,IAHK,CAILC,OAJK,CAQC,CACN,GAAI,qBAAUH,GAAV,CAAJ,CAAoB,CAClB,OACD,CAED;AACAA,GAAG,CAACI,SAAJ,CACE,cADF,CAEEF,IAAI,GAAK,MAAT,CAAkB,kBAAlB,CAAuC,0BAFzC,EAIAF,GAAG,CAACI,SAAJ,CAAc,gBAAd,CAAgCC,MAAM,CAACC,UAAP,CAAkBL,OAAlB,CAAhC,EACA,GAAIE,OAAO,EAAI,IAAf,CAAqB,CACnB,GAAIA,OAAO,CAACI,OAAR,EAAmBJ,OAAO,CAACK,QAA/B,CAAyC,CACvC,GAAIL,OAAO,CAACI,OAAR,EAAmB,CAACP,GAAG,CAACS,SAAJ,CAAc,eAAd,CAAxB,CAAwD,CACtDT,GAAG,CAACI,SAAJ,CACE,eADF,CAEG,yDAFH,EAID,CACF,CAPD,IAOO,IAAI,MAAOD,CAAAA,OAAO,CAACO,UAAf,GAA8B,QAAlC,CAA4C,CACjD,GAAIP,OAAO,CAACO,UAAR,CAAqB,CAAzB,CAA4B,CAC1B,KAAM,IAAIC,CAAAA,KAAJ,CACH,uDAAsDR,OAAO,CAACO,UAAW,MADtE,CAAN,CAGD,CAEDV,GAAG,CAACI,SAAJ,CACE,eADF,CAEG,YAAWD,OAAO,CAACO,UAAW,0BAFjC,EAID,CAXM,IAWA,IAAIP,OAAO,CAACO,UAAR,GAAuB,KAA3B,CAAkC,CACvCV,GAAG,CAACI,SAAJ,CACE,eADF,CAEG,2CAFH,EAID,CACF,CACDJ,GAAG,CAACY,GAAJ,CAAQX,OAAR,EACD","sourcesContent":["import { ServerResponse } from 'http'\nimport { isResSent } from '../lib/utils'\n\nexport function sendPayload(\n  res: ServerResponse,\n  payload: any,\n  type: 'html' | 'json',\n  options?:\n    | { private: true }\n    | { private: boolean; stateful: true }\n    | { private: boolean; stateful: false; revalidate: number | false }\n): void {\n  if (isResSent(res)) {\n    return\n  }\n\n  // TODO: ETag headers?\n  res.setHeader(\n    'Content-Type',\n    type === 'json' ? 'application/json' : 'text/html; charset=utf-8'\n  )\n  res.setHeader('Content-Length', Buffer.byteLength(payload))\n  if (options != null) {\n    if (options.private || options.stateful) {\n      if (options.private || !res.hasHeader('Cache-Control')) {\n        res.setHeader(\n          'Cache-Control',\n          `private, no-cache, no-store, max-age=0, must-revalidate`\n        )\n      }\n    } else if (typeof options.revalidate === 'number') {\n      if (options.revalidate < 1) {\n        throw new Error(\n          `invariant: invalid Cache-Control duration provided: ${options.revalidate} < 1`\n        )\n      }\n\n      res.setHeader(\n        'Cache-Control',\n        `s-maxage=${options.revalidate}, stale-while-revalidate`\n      )\n    } else if (options.revalidate === false) {\n      res.setHeader(\n        'Cache-Control',\n        `s-maxage=31536000, stale-while-revalidate`\n      )\n    }\n  }\n  res.end(payload)\n}\n"]}