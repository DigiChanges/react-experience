{"version":3,"sources":["../../../next-server/server/send-html.ts"],"names":["sendHTML","req","res","html","generateEtags","poweredByHeader","etag","undefined","setHeader","headers","statusCode","end","getHeader","Buffer","byteLength","method"],"mappings":"+DACA,qEACA,uEACA,mC,mFAEO,QAASA,CAAAA,QAAT,CACLC,GADK,CAELC,GAFK,CAGLC,IAHK,CAIL,CACEC,aADF,CAEEC,eAFF,CAJK,CAQL,CACA,GAAI,qBAAUH,GAAV,CAAJ,CAAoB,OACpB,KAAMI,CAAAA,IAAI,CAAGF,aAAa,CAAG,kBAAaD,IAAb,CAAH,CAAwBI,SAAlD,CAEA,GAAIF,eAAJ,CAAqB,CACnBH,GAAG,CAACM,SAAJ,CAAc,cAAd,CAA8B,SAA9B,EACD,CAED,GAAI,mBAAMP,GAAG,CAACQ,OAAV,CAAmB,CAAEH,IAAF,CAAnB,CAAJ,CAAkC,CAChCJ,GAAG,CAACQ,UAAJ,CAAiB,GAAjB,CACAR,GAAG,CAACS,GAAJ,GACA,OACD,CAED,GAAIL,IAAJ,CAAU,CACRJ,GAAG,CAACM,SAAJ,CAAc,MAAd,CAAsBF,IAAtB,EACD,CAED,GAAI,CAACJ,GAAG,CAACU,SAAJ,CAAc,cAAd,CAAL,CAAoC,CAClCV,GAAG,CAACM,SAAJ,CAAc,cAAd,CAA8B,0BAA9B,EACD,CACDN,GAAG,CAACM,SAAJ,CAAc,gBAAd,CAAgCK,MAAM,CAACC,UAAP,CAAkBX,IAAlB,CAAhC,EACAD,GAAG,CAACS,GAAJ,CAAQV,GAAG,CAACc,MAAJ,GAAe,MAAf,CAAwB,IAAxB,CAA+BZ,IAAvC,EACD","sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport generateETag from 'next/dist/compiled/etag'\nimport fresh from 'next/dist/compiled/fresh'\nimport { isResSent } from '../lib/utils'\n\nexport function sendHTML(\n  req: IncomingMessage,\n  res: ServerResponse,\n  html: string,\n  {\n    generateEtags,\n    poweredByHeader,\n  }: { generateEtags: boolean; poweredByHeader: boolean }\n) {\n  if (isResSent(res)) return\n  const etag = generateEtags ? generateETag(html) : undefined\n\n  if (poweredByHeader) {\n    res.setHeader('X-Powered-By', 'Next.js')\n  }\n\n  if (fresh(req.headers, { etag })) {\n    res.statusCode = 304\n    res.end()\n    return\n  }\n\n  if (etag) {\n    res.setHeader('ETag', etag)\n  }\n\n  if (!res.getHeader('Content-Type')) {\n    res.setHeader('Content-Type', 'text/html; charset=utf-8')\n  }\n  res.setHeader('Content-Length', Buffer.byteLength(html))\n  res.end(req.method === 'HEAD' ? null : html)\n}\n"]}