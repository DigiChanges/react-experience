{"version":3,"sources":["../../../next-server/server/render.tsx"],"names":["noRouter","message","Error","ServerRouter","constructor","pathname","query","as","isFallback","basePath","route","asPath","events","replace","push","reload","back","prefetch","beforePopState","enhanceComponents","options","App","Component","enhanceApp","enhanceComponent","render","renderElementToString","element","ampMode","html","head","Head","rewind","renderDocument","Document","props","docProps","buildId","canonicalBase","assetPrefix","runtimeConfig","nextExport","autoExport","dynamicImportsIds","dangerousAsPath","err","dev","ampPath","ampState","inAmpMode","hybridAmp","staticMarkup","devFiles","files","lowPriorityFiles","polyfillFiles","dynamicImports","htmlProps","bodyTags","headTags","gsp","gssp","customServer","gip","appGip","unstable_runtimeJS","__NEXT_DATA__","page","undefined","dynamicIds","length","serializeError","isDevelopment","invalidKeysMsg","methodName","invalidKeys","join","renderToHTML","req","res","renderOpts","pageConfig","buildManifest","reactLoadableManifest","ErrorDebug","getStaticProps","getStaticPaths","getServerSideProps","isDataReq","params","previewProps","callMiddleware","method","args","results","middlewareFunc","default","curResults","result","didRewrite","_nextDidRewrite","__nextFallback","isSSG","isBuildTimeSSG","defaultAppGetInitialProps","getInitialProps","origGetInitialProps","hasPageGetInitialProps","pageIsDynamic","isAutoExport","GSSP_COMPONENT_MEMBER_ERROR","process","env","NODE_ENV","SSG_GET_INITIAL_PROPS_CONFLICT","SERVER_PROPS_GET_INIT_PROPS_CONFLICT","SERVER_PROPS_SSG_CONFLICT","isValidElementType","require","amp","url","PAGES_404_GET_INITIAL_PROPS_ERROR","Loadable","preloadAll","router","ctx","AppTree","ampFirst","hasQuery","Boolean","hybrid","reactLoadableModules","AppContainer","children","moduleName","STATIC_PROPS_ID","previewData","data","preview","code","Object","keys","filter","key","includes","UNSTABLE_REVALIDATE_RENAME_ERROR","unstable_revalidate","Number","isInteger","Math","ceil","console","warn","pageProps","assign","revalidate","pageData","SERVER_PROPS_ID","error","Set","renderToStaticMarkup","renderToString","renderPageError","renderPage","renderError","EnhancedApp","EnhancedComponent","documentCtx","dynamicImportIdsSet","mod","manifestItem","forEach","item","add","id","ampRenderIndex","indexOf","AMP_RENDER_TARGET","substring","ampOptimizerConfig","ampSkipValidation","ampValidator","errorToJSON","name","stack","statusCode"],"mappings":"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","sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport { ParsedUrlQuery } from 'querystring'\nimport React from 'react'\nimport { renderToStaticMarkup, renderToString } from 'react-dom/server'\nimport {\n  PAGES_404_GET_INITIAL_PROPS_ERROR,\n  SERVER_PROPS_GET_INIT_PROPS_CONFLICT,\n  SERVER_PROPS_SSG_CONFLICT,\n  SSG_GET_INITIAL_PROPS_CONFLICT,\n  UNSTABLE_REVALIDATE_RENAME_ERROR,\n  GSSP_COMPONENT_MEMBER_ERROR,\n} from '../../lib/constants'\nimport { isSerializableProps } from '../../lib/is-serializable-props'\nimport { isInAmpMode } from '../lib/amp'\nimport { AmpStateContext } from '../lib/amp-context'\nimport {\n  AMP_RENDER_TARGET,\n  STATIC_PROPS_ID,\n  SERVER_PROPS_ID,\n} from '../lib/constants'\nimport Head, { defaultHead } from '../lib/head'\nimport Loadable from '../lib/loadable'\nimport { LoadableContext } from '../lib/loadable-context'\nimport mitt, { MittEmitter } from '../lib/mitt'\nimport { RouterContext } from '../lib/router-context'\nimport { NextRouter } from '../lib/router/router'\nimport { isDynamicRoute } from '../lib/router/utils/is-dynamic'\nimport {\n  AppType,\n  ComponentsEnhancer,\n  DocumentInitialProps,\n  DocumentType,\n  getDisplayName,\n  isResSent,\n  loadGetInitialProps,\n  NextComponentType,\n  RenderPage,\n} from '../lib/utils'\nimport { tryGetPreviewData, __ApiPreviewProps } from './api-utils'\nimport { getPageFiles } from './get-page-files'\nimport { LoadComponentsReturnType, ManifestItem } from './load-components'\nimport optimizeAmp from './optimize-amp'\nimport { UnwrapPromise } from '../../lib/coalesced-function'\nimport { GetStaticProps, GetServerSideProps } from '../../types'\n\nfunction noRouter() {\n  const message =\n    'No router instance found. you should only use \"next/router\" inside the client side of your app. https://err.sh/vercel/next.js/no-router-instance'\n  throw new Error(message)\n}\n\nclass ServerRouter implements NextRouter {\n  route: string\n  pathname: string\n  query: ParsedUrlQuery\n  asPath: string\n  basePath: string\n  events: any\n  isFallback: boolean\n  // TODO: Remove in the next major version, as this would mean the user is adding event listeners in server-side `render` method\n  static events: MittEmitter = mitt()\n\n  constructor(\n    pathname: string,\n    query: ParsedUrlQuery,\n    as: string,\n    { isFallback }: { isFallback: boolean },\n    basePath: string\n  ) {\n    this.route = pathname.replace(/\\/$/, '') || '/'\n    this.pathname = pathname\n    this.query = query\n    this.asPath = as\n    this.isFallback = isFallback\n    this.basePath = basePath\n  }\n  push(): any {\n    noRouter()\n  }\n  replace(): any {\n    noRouter()\n  }\n  reload() {\n    noRouter()\n  }\n  back() {\n    noRouter()\n  }\n  prefetch(): any {\n    noRouter()\n  }\n  beforePopState() {\n    noRouter()\n  }\n}\n\nfunction enhanceComponents(\n  options: ComponentsEnhancer,\n  App: AppType,\n  Component: NextComponentType\n): {\n  App: AppType\n  Component: NextComponentType\n} {\n  // For backwards compatibility\n  if (typeof options === 'function') {\n    return {\n      App,\n      Component: options(Component),\n    }\n  }\n\n  return {\n    App: options.enhanceApp ? options.enhanceApp(App) : App,\n    Component: options.enhanceComponent\n      ? options.enhanceComponent(Component)\n      : Component,\n  }\n}\n\nfunction render(\n  renderElementToString: (element: React.ReactElement<any>) => string,\n  element: React.ReactElement<any>,\n  ampMode: any\n): { html: string; head: React.ReactElement[] } {\n  let html\n  let head\n\n  try {\n    html = renderElementToString(element)\n  } finally {\n    head = Head.rewind() || defaultHead(isInAmpMode(ampMode))\n  }\n\n  return { html, head }\n}\n\nexport type RenderOptsPartial = {\n  staticMarkup: boolean\n  buildId: string\n  canonicalBase: string\n  runtimeConfig?: { [key: string]: any }\n  assetPrefix?: string\n  err?: Error | null\n  autoExport?: boolean\n  nextExport?: boolean\n  dev?: boolean\n  ampMode?: any\n  ampPath?: string\n  inAmpMode?: boolean\n  hybridAmp?: boolean\n  ErrorDebug?: React.ComponentType<{ error: Error }>\n  ampValidator?: (html: string, pathname: string) => Promise<void>\n  ampSkipValidation?: boolean\n  ampOptimizerConfig?: { [key: string]: any }\n  isDataReq?: boolean\n  params?: ParsedUrlQuery\n  previewProps: __ApiPreviewProps\n  basePath: string\n  unstable_runtimeJS?: false\n}\n\nexport type RenderOpts = LoadComponentsReturnType & RenderOptsPartial\n\nfunction renderDocument(\n  Document: DocumentType,\n  {\n    props,\n    docProps,\n    pathname,\n    query,\n    buildId,\n    canonicalBase,\n    assetPrefix,\n    runtimeConfig,\n    nextExport,\n    autoExport,\n    isFallback,\n    dynamicImportsIds,\n    dangerousAsPath,\n    err,\n    dev,\n    ampPath,\n    ampState,\n    inAmpMode,\n    hybridAmp,\n    staticMarkup,\n    devFiles,\n    files,\n    lowPriorityFiles,\n    polyfillFiles,\n    dynamicImports,\n    htmlProps,\n    bodyTags,\n    headTags,\n    gsp,\n    gssp,\n    customServer,\n    gip,\n    appGip,\n    unstable_runtimeJS,\n  }: RenderOpts & {\n    props: any\n    docProps: DocumentInitialProps\n    pathname: string\n    query: ParsedUrlQuery\n    dangerousAsPath: string\n    ampState: any\n    ampPath: string\n    inAmpMode: boolean\n    hybridAmp: boolean\n    dynamicImportsIds: string[]\n    dynamicImports: ManifestItem[]\n    devFiles: string[]\n    files: string[]\n    lowPriorityFiles: string[]\n    polyfillFiles: string[]\n    htmlProps: any\n    bodyTags: any\n    headTags: any\n    isFallback?: boolean\n    gsp?: boolean\n    gssp?: boolean\n    customServer?: boolean\n    gip?: boolean\n    appGip?: boolean\n  }\n): string {\n  return (\n    '<!DOCTYPE html>' +\n    renderToStaticMarkup(\n      <AmpStateContext.Provider value={ampState}>\n        {Document.renderDocument(Document, {\n          __NEXT_DATA__: {\n            props, // The result of getInitialProps\n            page: pathname, // The rendered page\n            query, // querystring parsed / passed by the user\n            buildId, // buildId is used to facilitate caching of page bundles, we send it to the client so that pageloader knows where to load bundles\n            assetPrefix: assetPrefix === '' ? undefined : assetPrefix, // send assetPrefix to the client side when configured, otherwise don't sent in the resulting HTML\n            runtimeConfig, // runtimeConfig if provided, otherwise don't sent in the resulting HTML\n            nextExport, // If this is a page exported by `next export`\n            autoExport, // If this is an auto exported page\n            isFallback,\n            dynamicIds:\n              dynamicImportsIds.length === 0 ? undefined : dynamicImportsIds,\n            err: err ? serializeError(dev, err) : undefined, // Error if one happened, otherwise don't sent in the resulting HTML\n            gsp, // whether the page is getStaticProps\n            gssp, // whether the page is getServerSideProps\n            customServer, // whether the user is using a custom server\n            gip, // whether the page has getInitialProps\n            appGip, // whether the _app has getInitialProps\n          },\n          dangerousAsPath,\n          canonicalBase,\n          ampPath,\n          inAmpMode,\n          isDevelopment: !!dev,\n          hybridAmp,\n          staticMarkup,\n          devFiles,\n          files,\n          lowPriorityFiles,\n          polyfillFiles,\n          dynamicImports,\n          assetPrefix,\n          htmlProps,\n          bodyTags,\n          headTags,\n          unstable_runtimeJS,\n          ...docProps,\n        })}\n      </AmpStateContext.Provider>\n    )\n  )\n}\n\nconst invalidKeysMsg = (methodName: string, invalidKeys: string[]) => {\n  return (\n    `Additional keys were returned from \\`${methodName}\\`. Properties intended for your component must be nested under the \\`props\\` key, e.g.:` +\n    `\\n\\n\\treturn { props: { title: 'My Title', content: '...' } }` +\n    `\\n\\nKeys that need to be moved: ${invalidKeys.join(', ')}.` +\n    `\\nRead more: https://err.sh/next.js/invalid-getstaticprops-value`\n  )\n}\n\nexport async function renderToHTML(\n  req: IncomingMessage,\n  res: ServerResponse,\n  pathname: string,\n  query: ParsedUrlQuery,\n  renderOpts: RenderOpts\n): Promise<string | null> {\n  pathname = pathname === '/index' ? '/' : pathname\n  const {\n    err,\n    dev = false,\n    staticMarkup = false,\n    ampPath = '',\n    App,\n    Document,\n    pageConfig = {},\n    Component,\n    buildManifest,\n    reactLoadableManifest,\n    ErrorDebug,\n    getStaticProps,\n    getStaticPaths,\n    getServerSideProps,\n    isDataReq,\n    params,\n    previewProps,\n    basePath,\n  } = renderOpts\n\n  const callMiddleware = async (method: string, args: any[], props = false) => {\n    let results: any = props ? {} : []\n\n    if ((Document as any)[`${method}Middleware`]) {\n      let middlewareFunc = await (Document as any)[`${method}Middleware`]\n      middlewareFunc = middlewareFunc.default || middlewareFunc\n\n      const curResults = await middlewareFunc(...args)\n      if (props) {\n        for (const result of curResults) {\n          results = {\n            ...results,\n            ...result,\n          }\n        }\n      } else {\n        results = curResults\n      }\n    }\n    return results\n  }\n\n  const headTags = (...args: any) => callMiddleware('headTags', args)\n  const bodyTags = (...args: any) => callMiddleware('bodyTags', args)\n  const htmlProps = (...args: any) => callMiddleware('htmlProps', args, true)\n\n  const didRewrite = (req as any)._nextDidRewrite\n  const isFallback = !!query.__nextFallback\n  delete query.__nextFallback\n\n  const isSSG = !!getStaticProps\n  const isBuildTimeSSG = isSSG && renderOpts.nextExport\n  const defaultAppGetInitialProps =\n    App.getInitialProps === (App as any).origGetInitialProps\n\n  const hasPageGetInitialProps = !!(Component as any).getInitialProps\n\n  const pageIsDynamic = isDynamicRoute(pathname)\n\n  const isAutoExport =\n    !hasPageGetInitialProps &&\n    defaultAppGetInitialProps &&\n    !isSSG &&\n    !getServerSideProps\n\n  for (const methodName of [\n    'getStaticProps',\n    'getServerSideProps',\n    'getStaticPaths',\n  ]) {\n    if ((Component as any)[methodName]) {\n      throw new Error(\n        `page ${pathname} ${methodName} ${GSSP_COMPONENT_MEMBER_ERROR}`\n      )\n    }\n  }\n\n  if (\n    process.env.NODE_ENV !== 'production' &&\n    (isAutoExport || isFallback) &&\n    pageIsDynamic &&\n    didRewrite\n  ) {\n    // TODO: add err.sh when rewrites go stable\n    // Behavior might change before then (prefer SSR in this case).\n    // If we decide to ship rewrites to the client we could solve this\n    // by running over the rewrites and getting the params.\n    throw new Error(\n      `Rewrites don't support${\n        isFallback ? ' ' : ' auto-exported '\n      }dynamic pages${isFallback ? ' with getStaticProps ' : ' '}yet. ` +\n        `Using this will cause the page to fail to parse the params on the client${\n          isFallback ? ' for the fallback page ' : ''\n        }`\n    )\n  }\n\n  if (hasPageGetInitialProps && isSSG) {\n    throw new Error(SSG_GET_INITIAL_PROPS_CONFLICT + ` ${pathname}`)\n  }\n\n  if (hasPageGetInitialProps && getServerSideProps) {\n    throw new Error(SERVER_PROPS_GET_INIT_PROPS_CONFLICT + ` ${pathname}`)\n  }\n\n  if (getServerSideProps && isSSG) {\n    throw new Error(SERVER_PROPS_SSG_CONFLICT + ` ${pathname}`)\n  }\n\n  if (!!getStaticPaths && !isSSG) {\n    throw new Error(\n      `getStaticPaths was added without a getStaticProps in ${pathname}. Without getStaticProps, getStaticPaths does nothing`\n    )\n  }\n\n  if (isSSG && pageIsDynamic && !getStaticPaths) {\n    throw new Error(\n      `getStaticPaths is required for dynamic SSG pages and is missing for '${pathname}'.` +\n        `\\nRead more: https://err.sh/next.js/invalid-getstaticpaths-value`\n    )\n  }\n\n  if (dev) {\n    const { isValidElementType } = require('react-is')\n    if (!isValidElementType(Component)) {\n      throw new Error(\n        `The default export is not a React Component in page: \"${pathname}\"`\n      )\n    }\n\n    if (!isValidElementType(App)) {\n      throw new Error(\n        `The default export is not a React Component in page: \"/_app\"`\n      )\n    }\n\n    if (!isValidElementType(Document)) {\n      throw new Error(\n        `The default export is not a React Component in page: \"/_document\"`\n      )\n    }\n\n    if (isAutoExport) {\n      // remove query values except ones that will be set during export\n      query = {\n        amp: query.amp,\n      }\n      req.url = pathname\n      renderOpts.nextExport = true\n    }\n\n    if (pathname === '/404' && (hasPageGetInitialProps || getServerSideProps)) {\n      throw new Error(PAGES_404_GET_INITIAL_PROPS_ERROR)\n    }\n  }\n  if (isAutoExport) renderOpts.autoExport = true\n  if (isSSG) renderOpts.nextExport = false\n\n  await Loadable.preloadAll() // Make sure all dynamic imports are loaded\n\n  // url will always be set\n  const asPath: string = req.url as string\n  const router = new ServerRouter(\n    pathname,\n    query,\n    asPath,\n    {\n      isFallback: isFallback,\n    },\n    basePath\n  )\n  const ctx = {\n    err,\n    req: isAutoExport ? undefined : req,\n    res: isAutoExport ? undefined : res,\n    pathname,\n    query,\n    asPath,\n    AppTree: (props: any) => {\n      return (\n        <AppContainer>\n          <App {...props} Component={Component} router={router} />\n        </AppContainer>\n      )\n    },\n  }\n  let props: any\n\n  const ampState = {\n    ampFirst: pageConfig.amp === true,\n    hasQuery: Boolean(query.amp),\n    hybrid: pageConfig.amp === 'hybrid',\n  }\n\n  const reactLoadableModules: string[] = []\n\n  const AppContainer = ({ children }: any) => (\n    <RouterContext.Provider value={router}>\n      <AmpStateContext.Provider value={ampState}>\n        <LoadableContext.Provider\n          value={(moduleName) => reactLoadableModules.push(moduleName)}\n        >\n          {children}\n        </LoadableContext.Provider>\n      </AmpStateContext.Provider>\n    </RouterContext.Provider>\n  )\n\n  try {\n    props = await loadGetInitialProps(App, {\n      AppTree: ctx.AppTree,\n      Component,\n      router,\n      ctx,\n    })\n\n    if (isSSG) {\n      props[STATIC_PROPS_ID] = true\n    }\n\n    let previewData: string | false | object | undefined\n\n    if ((isSSG || getServerSideProps) && !isFallback) {\n      // Reads of this are cached on the `req` object, so this should resolve\n      // instantly. There's no need to pass this data down from a previous\n      // invoke, where we'd have to consider server & serverless.\n      previewData = tryGetPreviewData(req, res, previewProps)\n    }\n\n    if (isSSG && !isFallback) {\n      let data: UnwrapPromise<ReturnType<GetStaticProps>>\n\n      try {\n        data = await getStaticProps!({\n          ...(pageIsDynamic ? { params: query as ParsedUrlQuery } : undefined),\n          ...(previewData !== false\n            ? { preview: true, previewData: previewData }\n            : undefined),\n        })\n      } catch (err) {\n        // remove not found error code to prevent triggering legacy\n        // 404 rendering\n        if (err.code === 'ENOENT') {\n          delete err.code\n        }\n        throw err\n      }\n\n      const invalidKeys = Object.keys(data).filter(\n        (key) => key !== 'unstable_revalidate' && key !== 'props'\n      )\n\n      if (invalidKeys.includes('revalidate')) {\n        throw new Error(UNSTABLE_REVALIDATE_RENAME_ERROR)\n      }\n\n      if (invalidKeys.length) {\n        throw new Error(invalidKeysMsg('getStaticProps', invalidKeys))\n      }\n\n      if (\n        (dev || isBuildTimeSSG) &&\n        !isSerializableProps(pathname, 'getStaticProps', data.props)\n      ) {\n        // this fn should throw an error instead of ever returning `false`\n        throw new Error(\n          'invariant: getStaticProps did not return valid props. Please report this.'\n        )\n      }\n\n      if (typeof data.unstable_revalidate === 'number') {\n        if (!Number.isInteger(data.unstable_revalidate)) {\n          throw new Error(\n            `A page's revalidate option must be seconds expressed as a natural number. Mixed numbers, such as '${data.unstable_revalidate}', cannot be used.` +\n              `\\nTry changing the value to '${Math.ceil(\n                data.unstable_revalidate\n              )}' or using \\`Math.ceil()\\` if you're computing the value.`\n          )\n        } else if (data.unstable_revalidate <= 0) {\n          throw new Error(\n            `A page's revalidate option can not be less than or equal to zero. A revalidate option of zero means to revalidate after _every_ request, and implies stale data cannot be tolerated.` +\n              `\\n\\nTo never revalidate, you can set revalidate to \\`false\\` (only ran once at build-time).` +\n              `\\nTo revalidate as soon as possible, you can set the value to \\`1\\`.`\n          )\n        } else if (data.unstable_revalidate > 31536000) {\n          // if it's greater than a year for some reason error\n          console.warn(\n            `Warning: A page's revalidate option was set to more than a year. This may have been done in error.` +\n              `\\nTo only run getStaticProps at build-time and not revalidate at runtime, you can set \\`revalidate\\` to \\`false\\`!`\n          )\n        }\n      } else if (data.unstable_revalidate === true) {\n        // When enabled, revalidate after 1 second. This value is optimal for\n        // the most up-to-date page possible, but without a 1-to-1\n        // request-refresh ratio.\n        data.unstable_revalidate = 1\n      } else {\n        // By default, we never revalidate.\n        data.unstable_revalidate = false\n      }\n\n      props.pageProps = Object.assign({}, props.pageProps, data.props)\n      // pass up revalidate and props for export\n      // TODO: change this to a different passing mechanism\n      ;(renderOpts as any).revalidate = data.unstable_revalidate\n      ;(renderOpts as any).pageData = props\n    }\n\n    if (getServerSideProps) {\n      props[SERVER_PROPS_ID] = true\n    }\n\n    if (getServerSideProps && !isFallback) {\n      let data: UnwrapPromise<ReturnType<GetServerSideProps>>\n\n      try {\n        data = await getServerSideProps({\n          req,\n          res,\n          query,\n          ...(pageIsDynamic ? { params: params as ParsedUrlQuery } : undefined),\n          ...(previewData !== false\n            ? { preview: true, previewData: previewData }\n            : undefined),\n        })\n      } catch (err) {\n        // remove not found error code to prevent triggering legacy\n        // 404 rendering\n        if (err.code === 'ENOENT') {\n          delete err.code\n        }\n        throw err\n      }\n\n      const invalidKeys = Object.keys(data).filter((key) => key !== 'props')\n\n      if (invalidKeys.length) {\n        throw new Error(invalidKeysMsg('getServerSideProps', invalidKeys))\n      }\n\n      if (\n        (dev || isBuildTimeSSG) &&\n        !isSerializableProps(pathname, 'getServerSideProps', data.props)\n      ) {\n        // this fn should throw an error instead of ever returning `false`\n        throw new Error(\n          'invariant: getServerSideProps did not return valid props. Please report this.'\n        )\n      }\n\n      props.pageProps = Object.assign({}, props.pageProps, data.props)\n      ;(renderOpts as any).pageData = props\n    }\n  } catch (err) {\n    if (isDataReq || !dev || !err) throw err\n    ctx.err = err\n    renderOpts.err = err\n    console.error(err)\n  }\n\n  if (\n    !isSSG && // we only show this warning for legacy pages\n    !getServerSideProps &&\n    process.env.NODE_ENV !== 'production' &&\n    Object.keys(props?.pageProps || {}).includes('url')\n  ) {\n    console.warn(\n      `The prop \\`url\\` is a reserved prop in Next.js for legacy reasons and will be overridden on page ${pathname}\\n` +\n        `See more info here: https://err.sh/vercel/next.js/reserved-page-prop`\n    )\n  }\n\n  // We only need to do this if we want to support calling\n  // _app's getInitialProps for getServerSideProps if not this can be removed\n  if (isDataReq && !isSSG) return props\n\n  // We don't call getStaticProps or getServerSideProps while generating\n  // the fallback so make sure to set pageProps to an empty object\n  if (isFallback) {\n    props.pageProps = {}\n  }\n\n  // the response might be finished on the getInitialProps call\n  if (isResSent(res) && !isSSG) return null\n\n  const devFiles = buildManifest.devFiles\n  const files = [\n    ...new Set([\n      ...getPageFiles(buildManifest, '/_app'),\n      ...getPageFiles(buildManifest, pathname),\n    ]),\n  ]\n  const lowPriorityFiles = buildManifest.lowPriorityFiles\n  const polyfillFiles = getPageFiles(buildManifest, '/_polyfills')\n\n  const renderElementToString = staticMarkup\n    ? renderToStaticMarkup\n    : renderToString\n\n  const renderPageError = (): { html: string; head: any } | void => {\n    if (ctx.err && ErrorDebug) {\n      return render(\n        renderElementToString,\n        <ErrorDebug error={ctx.err} />,\n        ampState\n      )\n    }\n\n    if (dev && (props.router || props.Component)) {\n      throw new Error(\n        `'router' and 'Component' can not be returned in getInitialProps from _app.js https://err.sh/vercel/next.js/cant-override-next-props`\n      )\n    }\n  }\n\n  let renderPage: RenderPage = (\n    options: ComponentsEnhancer = {}\n  ): { html: string; head: any } => {\n    const renderError = renderPageError()\n    if (renderError) return renderError\n\n    const {\n      App: EnhancedApp,\n      Component: EnhancedComponent,\n    } = enhanceComponents(options, App, Component)\n\n    return render(\n      renderElementToString,\n      <AppContainer>\n        <EnhancedApp Component={EnhancedComponent} router={router} {...props} />\n      </AppContainer>,\n      ampState\n    )\n  }\n  const documentCtx = { ...ctx, renderPage }\n  const docProps: DocumentInitialProps = await loadGetInitialProps(\n    Document,\n    documentCtx\n  )\n  // the response might be finished on the getInitialProps call\n  if (isResSent(res) && !isSSG) return null\n\n  if (!docProps || typeof docProps.html !== 'string') {\n    const message = `\"${getDisplayName(\n      Document\n    )}.getInitialProps()\" should resolve to an object with a \"html\" prop set with a valid html string`\n    throw new Error(message)\n  }\n\n  const dynamicImportIdsSet = new Set<string>()\n  const dynamicImports: ManifestItem[] = []\n\n  for (const mod of reactLoadableModules) {\n    const manifestItem: ManifestItem[] = reactLoadableManifest[mod]\n\n    if (manifestItem) {\n      manifestItem.forEach((item) => {\n        dynamicImports.push(item)\n        dynamicImportIdsSet.add(item.id as string)\n      })\n    }\n  }\n\n  const dynamicImportsIds = [...dynamicImportIdsSet]\n  const inAmpMode = isInAmpMode(ampState)\n  const hybridAmp = ampState.hybrid\n\n  // update renderOpts so export knows current state\n  renderOpts.inAmpMode = inAmpMode\n  renderOpts.hybridAmp = hybridAmp\n\n  let html = renderDocument(Document, {\n    ...renderOpts,\n    // Only enabled in production as development mode has features relying on HMR (style injection for example)\n    unstable_runtimeJS:\n      process.env.NODE_ENV === 'production'\n        ? pageConfig.unstable_runtimeJS\n        : undefined,\n    dangerousAsPath: router.asPath,\n    ampState,\n    props,\n    headTags: await headTags(documentCtx),\n    bodyTags: await bodyTags(documentCtx),\n    htmlProps: await htmlProps(documentCtx),\n    isFallback,\n    docProps,\n    pathname,\n    ampPath,\n    query,\n    inAmpMode,\n    hybridAmp,\n    dynamicImportsIds,\n    dynamicImports,\n    devFiles,\n    files,\n    lowPriorityFiles,\n    polyfillFiles,\n    gsp: !!getStaticProps ? true : undefined,\n    gssp: !!getServerSideProps ? true : undefined,\n    gip: hasPageGetInitialProps ? true : undefined,\n    appGip: !defaultAppGetInitialProps ? true : undefined,\n  })\n\n  if (inAmpMode && html) {\n    // inject HTML to AMP_RENDER_TARGET to allow rendering\n    // directly to body in AMP mode\n    const ampRenderIndex = html.indexOf(AMP_RENDER_TARGET)\n    html =\n      html.substring(0, ampRenderIndex) +\n      `<!-- __NEXT_DATA__ -->${docProps.html}` +\n      html.substring(ampRenderIndex + AMP_RENDER_TARGET.length)\n    html = await optimizeAmp(html, renderOpts.ampOptimizerConfig)\n\n    if (!renderOpts.ampSkipValidation && renderOpts.ampValidator) {\n      await renderOpts.ampValidator(html, pathname)\n    }\n  }\n\n  if (inAmpMode || hybridAmp) {\n    // fix &amp being escaped for amphtml rel link\n    html = html.replace(/&amp;amp=1/g, '&amp=1')\n  }\n\n  return html\n}\n\nfunction errorToJSON(err: Error): Error {\n  const { name, message, stack } = err\n  return { name, message, stack }\n}\n\nfunction serializeError(\n  dev: boolean | undefined,\n  err: Error\n): Error & { statusCode?: number } {\n  if (dev) {\n    return errorToJSON(err)\n  }\n\n  return {\n    name: 'Internal Server Error.',\n    message: '500 - Internal Server Error.',\n    statusCode: 500,\n  }\n}\n"]}