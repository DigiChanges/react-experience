{"version":3,"sources":["../../client/page-loader.js"],"names":["hasRel","rel","link","document","createElement","relList","supports","relPrefetch","hasNoModule","normalizeRoute","route","Error","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","onload","onerror","head","appendChild","PageLoader","constructor","buildId","assetPrefix","pageCache","pageRegisterEvents","loadingRoutes","env","__NEXT_GRANULAR_CHUNKS","promisedBuildManifest","resolve","window","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","promisedSsgManifest","__SSG_MANIFEST","__SSG_MANIFEST_CB","getDependencies","then","man","map","url","encodeURI","getDataHref","asPath","getHrefForSlug","path","pathname","hrefPathname","query","asPathname","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","Array","isArray","encodeURIComponent","join","prefetchData","s","_dataHref","has","querySelector","loadPage","loadPageScript","reject","fire","error","page","mod","off","cachedPage","on","deps","forEach","d","test","loadScript","catch","loadRoute","scriptRoute","isPage","script","__NEXT_MODERN_BUILD","type","src","code","emit","body","registerPage","regFn","register","pageData","default","NODE_ENV","module","hot","status","console","log","check","removeStatusHandler","prefetch","isDependency","cn","navigator","connection","saveData","effectiveType","all","match","urls"],"mappings":"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","sourcesContent":["import { parse } from 'url'\nimport mitt from '../next-server/lib/mitt'\nimport { isDynamicRoute } from './../next-server/lib/router/utils/is-dynamic'\nimport { getRouteMatcher } from './../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from './../next-server/lib/router/utils/route-regex'\nimport { delBasePath } from './../next-server/lib/router/router'\n\nfunction hasRel(rel, link) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\n/** @param {string} route */\nfunction normalizeRoute(route) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n  route = route.replace(/\\/index$/, '/')\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(href, rel, as) {\n  return new Promise((res, rej, link) => {\n    link = document.createElement('link')\n    link.crossOrigin = process.crossOrigin\n    link.href = href\n    link.rel = rel\n    if (as) link.as = as\n\n    link.onload = res\n    link.onerror = rej\n\n    document.head.appendChild(link)\n  })\n}\n\nexport default class PageLoader {\n  constructor(buildId, assetPrefix) {\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {}\n    if (process.env.__NEXT_GRANULAR_CHUNKS) {\n      this.promisedBuildManifest = new Promise((resolve) => {\n        if (window.__BUILD_MANIFEST) {\n          resolve(window.__BUILD_MANIFEST)\n        } else {\n          window.__BUILD_MANIFEST_CB = () => {\n            resolve(window.__BUILD_MANIFEST)\n          }\n        }\n      })\n    }\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if (window.__SSG_MANIFEST) {\n        resolve(window.__SSG_MANIFEST)\n      } else {\n        window.__SSG_MANIFEST_CB = () => {\n          resolve(window.__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  getDependencies(route) {\n    return this.promisedBuildManifest.then(\n      (man) =>\n        (man[route] &&\n          man[route].map(\n            (url) => `${this.assetPrefix}/_next/${encodeURI(url)}`\n          )) ||\n        []\n    )\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href, asPath) {\n    const getHrefForSlug = (/** @type string */ path) => {\n      path = delBasePath(path)\n      return `${this.assetPrefix}/_next/data/${this.buildId}${\n        path === '/' ? '/index' : path\n      }.json`\n    }\n\n    const { pathname: hrefPathname, query } = parse(href, true)\n    const { pathname: asPathname } = parse(asPath)\n\n    const route = normalizeRoute(hrefPathname)\n\n    let isDynamic = isDynamicRoute(route),\n      interpolatedRoute\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param]\n          const repeat = dynamicGroups[param].repeat\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            param in dynamicMatches &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute = interpolatedRoute.replace(\n              `[${repeat ? '...' : ''}${param}]`,\n              repeat\n                ? value.map(encodeURIComponent).join('/')\n                : encodeURIComponent(value)\n            ))\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href, asPath) {\n    const { pathname: hrefPathname } = parse(href, true)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest.then(\n      (s, _dataHref) =>\n        // Check if the route requires a data file\n        s.has(route) &&\n        // Try to generate data href, noop when falsy\n        (_dataHref = this.getDataHref(href, asPath)) &&\n        // noop when data has already been prefetched (dedupe)\n        !document.querySelector(\n          `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n        ) &&\n        // Inject the `<link rel=prefetch>` tag for above computed `href`.\n        appendLink(_dataHref, relPrefetch, 'fetch')\n    )\n  }\n\n  loadPage(route) {\n    return this.loadPageScript(route)\n  }\n\n  loadPageScript(route) {\n    route = normalizeRoute(route)\n\n    return new Promise((resolve, reject) => {\n      const fire = ({ error, page, mod }) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if (error) {\n          reject(error)\n        } else {\n          resolve({ page, mod })\n        }\n      }\n\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        const { error, page, mod } = cachedPage\n        error ? reject(error) : resolve({ page, mod })\n        return\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      // If the page is loading via SSR, we need to wait for it\n      // rather downloading it again.\n      if (document.querySelector(`script[data-next-page=\"${route}\"]`)) {\n        return\n      }\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.__NEXT_GRANULAR_CHUNKS) {\n          this.getDependencies(route).then((deps) => {\n            deps.forEach((d) => {\n              if (\n                /\\.js$/.test(d) &&\n                !document.querySelector(`script[src^=\"${d}\"]`)\n              ) {\n                this.loadScript(d, route, false)\n              }\n              if (\n                /\\.css$/.test(d) &&\n                !document.querySelector(`link[rel=stylesheet][href^=\"${d}\"]`)\n              ) {\n                appendLink(d, 'stylesheet').catch(() => {\n                  // FIXME: handle failure\n                  // Right now, this is needed to prevent an unhandled rejection.\n                })\n              }\n            })\n            this.loadRoute(route)\n          })\n        } else {\n          this.loadRoute(route)\n        }\n      }\n    })\n  }\n\n  loadRoute(route) {\n    route = normalizeRoute(route)\n    let scriptRoute = route === '/' ? '/index.js' : `${route}.js`\n\n    const url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n      this.buildId\n    )}/pages${encodeURI(scriptRoute)}`\n    this.loadScript(url, route, true)\n  }\n\n  loadScript(url, route, isPage) {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n      // Only page bundle scripts need to have .module added to url,\n      // dependencies already have it added during build manifest creation\n      if (isPage) url = url.replace(/\\.js$/, '.module.js')\n    }\n    script.crossOrigin = process.crossOrigin\n    script.src = url\n    script.onerror = () => {\n      const error = new Error(`Error loading script ${url}`)\n      error.code = 'PAGE_LOAD_ERROR'\n      this.pageRegisterEvents.emit(route, { error })\n    }\n    document.body.appendChild(script)\n  }\n\n  // This method if called by the route code.\n  registerPage(route, regFn) {\n    const register = () => {\n      try {\n        const mod = regFn()\n        const pageData = { page: mod.default || mod, mod }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if (module.hot && module.hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status) => {\n          if (status === 'idle') {\n            module.hot.removeStatusHandler(check)\n            register()\n          }\n        }\n        module.hot.status(check)\n        return\n      }\n    }\n\n    register()\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route, isDependency) {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = navigator.connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      route = normalizeRoute(route)\n\n      let scriptRoute = `${route === '/' ? '/index' : route}.js`\n      if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n        scriptRoute = scriptRoute.replace(/\\.js$/, '.module.js')\n      }\n\n      url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n        this.buildId\n      )}/pages${encodeURI(scriptRoute)}`\n    }\n\n    return Promise.all(\n      document.querySelector(\n        `link[rel=\"${relPrefetch}\"][href^=\"${url}\"], script[data-next-page=\"${route}\"]`\n      )\n        ? []\n        : [\n            appendLink(\n              url,\n              relPrefetch,\n              url.match(/\\.css$/) ? 'style' : 'script'\n            ),\n            process.env.__NEXT_GRANULAR_CHUNKS &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(urls.map((url) => this.prefetch(url, true)))\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}