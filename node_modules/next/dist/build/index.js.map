{"version":3,"sources":["../../build/index.ts"],"names":["staticCheckWorker","require","resolve","build","dir","conf","Error","loadedEnvFiles","config","PHASE_PRODUCTION_BUILD","target","buildId","generateBuildId","nanoid","distDir","path","join","headers","rewrites","redirects","experimental","_redirects","push","_rewrites","_headers","ciEnvironment","isCI","hasNextSupport","cacheDir","hasCache","promises","access","then","catch","console","log","chalk","bold","yellow","buildSpinner","prefixText","telemetry","Telemetry","publicDir","pagesDir","publicFiles","hasPublicDir","record","cliCommand","isSrcDir","relative","startsWith","hasNowJson","cwd","isCustomServer","events","stat","_","tracer","profiling","createTrace","profiler","startProfiling","isLikeServerless","pagePaths","pageExtensions","allStaticPages","Set","allPageInfos","Map","previewProps","previewModeId","crypto","randomBytes","toString","previewModeSigningKey","previewModeEncryptionKey","mappedPages","entrypoints","pageKeys","Object","keys","conflictingPublicFiles","hasCustomErrorPage","hasPages404","Boolean","hasNonStaticErrorPage","PUBLIC_DIR_MIDDLEWARE_CONFLICT","err","file","replace","split","pop","numConflicting","length","nestedReservedPages","filter","page","match","dirname","warn","buildCustomRoute","r","type","routeRegex","source","strict","sensitive","delimiter","statusCode","permanent","undefined","regex","firstOptionalCatchAllPage","find","f","test","optionalCatchAll","msg","routesManifestPath","ROUTES_MANIFEST","routesManifest","version","pages404","basePath","map","dynamicRoutes","isDynamicRoute","re","namedRegex","routeKeys","groups","mkdir","recursive","writeFile","JSON","stringify","configs","Promise","all","isServer","client","server","clientConfig","optimization","minimize","minimizer","webpackBuildStart","process","hrtime","result","warnings","errors","clientResult","serverResult","webpackBuildEnd","stopAndPersist","error","red","indexOf","page_name_regex","parsed","exec","page_name","durationInSeconds","green","postBuildSpinner","manifestPath","SERVERLESS_DIRECTORY","SERVER_DIRECTORY","PAGES_MANIFEST","buildManifestPath","BUILD_MANIFEST","ssgPages","ssgFallbackPages","staticPages","invalidPages","hybridAmpPages","serverPropsPages","additionalSsgPaths","pageInfos","pagesManifest","parse","readFile","buildManifest","customAppGetInitialProps","namedExports","env","NEXT_PHASE","staticCheckWorkers","Worker","numWorkers","cpus","enableWorkerThreads","workerThreads","getStdout","pipe","stdout","getStderr","stderr","runtimeEnvConfig","publicRuntimeConfig","serverRuntimeConfig","analysisBegin","actualPage","selfSize","allSize","modern","bundleRelative","serverBundle","isSsg","isStatic","isHybridAmp","ssgPageRoutes","hasSsgFallback","nonReservedPage","isPageStatic","add","isAmpOnly","clientBundle","unlink","code","hasStaticProps","prerenderRoutes","set","prerenderFallback","hasServerProps","PAGES_404_GET_INITIAL_PROPS_ERROR","delete","message","size","totalSize","static","end","dataRoutes","pagePath","dataRoute","posix","dataRouteRegex","namedDataRouteRegex","RegExp","useStatic404","pg","Array","isArray","plugins","some","plugin","ampPages","forEach","get","isAmp","finalPrerenderRoutes","tbdPrerenderRoutes","combinedPages","exportApp","default","exportOptions","silent","buildExport","threads","pages","outdir","exportConfig","initialPageRevalidationMap","exportPathMap","defaultMap","has","query","__nextFallback","routes","route","exportTrailingSlash","moveExportedPage","ext","orig","relativeDest","dest","rename","isSsgFallback","isDynamic","hasAmp","initialRevalidateSeconds","srcRoute","extraRoutes","rmdir","analysisEnd","staticPageCount","staticPropsPageCount","serverPropsPageCount","ssrPageCount","hasStatic404","hasReportWebVitals","includes","finalDynamicRoutes","tbdRoute","normalizedRoute","fallback","prerenderManifest","preview","PRERENDER_MANIFEST","generateClientSsgManifest","isModern","EXPORT_MARKER","hasExportPathMap","EXPORT_DETAIL","reject","info","key","distPath","parsedResults","stopProfiling","destroy","trace","flush","cpuStartTime","profile","startTime","cpuEndTime","endTime","completeEvent","name","id","counter","cat","ts","args","src_file","src_func","dur","data","url","lineNumber","columnNumber","frame","instantEvent","cpuProfile","entries","clientSsgManifestPaths","CLIENT_STATIC_FILES_PATH","clientSsgManifestContent","clientSsgManifestPath"],"mappings":"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","sourcesContent":["import '../next-server/server/node-polyfill-fetch'\nimport crypto from 'crypto'\nimport { promises, writeFileSync } from 'fs'\nimport Worker from 'jest-worker'\nimport chalk from 'next/dist/compiled/chalk'\nimport devalue from 'next/dist/compiled/devalue'\nimport escapeStringRegexp from 'next/dist/compiled/escape-string-regexp'\nimport findUp from 'next/dist/compiled/find-up'\nimport nanoid from 'next/dist/compiled/nanoid/index.js'\nimport { pathToRegexp } from 'next/dist/compiled/path-to-regexp'\nimport path from 'path'\nimport formatWebpackMessages from '../client/dev/error-overlay/format-webpack-messages'\nimport checkCustomRoutes, {\n  getRedirectStatus,\n  Header,\n  Redirect,\n  Rewrite,\n  RouteType,\n} from '../lib/check-custom-routes'\nimport {\n  PAGES_404_GET_INITIAL_PROPS_ERROR,\n  PUBLIC_DIR_MIDDLEWARE_CONFLICT,\n} from '../lib/constants'\nimport { findPagesDir } from '../lib/find-pages-dir'\nimport { loadEnvConfig } from '../lib/load-env-config'\nimport { recursiveDelete } from '../lib/recursive-delete'\nimport { recursiveReadDir } from '../lib/recursive-readdir'\nimport { verifyTypeScriptSetup } from '../lib/verifyTypeScriptSetup'\nimport {\n  BUILD_MANIFEST,\n  CLIENT_STATIC_FILES_PATH,\n  EXPORT_DETAIL,\n  EXPORT_MARKER,\n  PAGES_MANIFEST,\n  PHASE_PRODUCTION_BUILD,\n  PRERENDER_MANIFEST,\n  ROUTES_MANIFEST,\n  SERVERLESS_DIRECTORY,\n  SERVER_DIRECTORY,\n} from '../next-server/lib/constants'\nimport {\n  getRouteRegex,\n  getSortedRoutes,\n  isDynamicRoute,\n} from '../next-server/lib/router/utils'\nimport { __ApiPreviewProps } from '../next-server/server/api-utils'\nimport loadConfig, {\n  isTargetLikeServerless,\n} from '../next-server/server/config'\nimport { normalizePagePath } from '../next-server/server/normalize-page-path'\nimport * as ciEnvironment from '../telemetry/ci-info'\nimport {\n  eventBuildCompleted,\n  eventBuildOptimize,\n  eventCliSession,\n  eventNextPlugins,\n} from '../telemetry/events'\nimport { Telemetry } from '../telemetry/storage'\nimport { CompilerResult, runCompiler } from './compiler'\nimport { createEntrypoints, createPagesMapping } from './entries'\nimport { generateBuildId } from './generate-build-id'\nimport { isWriteable } from './is-writeable'\nimport createSpinner from './spinner'\nimport {\n  collectPages,\n  getJsPageSizeInKb,\n  hasCustomGetInitialProps,\n  isPageStatic,\n  PageInfo,\n  printCustomRoutes,\n  printTreeView,\n  getNamedExports,\n} from './utils'\nimport getBaseWebpackConfig from './webpack-config'\nimport { writeBuildId } from './write-build-id'\nimport { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\nimport { BuildManifest } from '../next-server/server/get-page-files'\n\nconst staticCheckWorker = require.resolve('./utils')\n\nexport type SsgRoute = {\n  initialRevalidateSeconds: number | false\n  srcRoute: string | null\n  dataRoute: string\n}\n\nexport type DynamicSsgRoute = {\n  routeRegex: string\n  fallback: string | false\n  dataRoute: string\n  dataRouteRegex: string\n}\n\nexport type PrerenderManifest = {\n  version: 2\n  routes: { [route: string]: SsgRoute }\n  dynamicRoutes: { [route: string]: DynamicSsgRoute }\n  preview: __ApiPreviewProps\n}\n\nexport default async function build(dir: string, conf = null): Promise<void> {\n  if (!(await isWriteable(dir))) {\n    throw new Error(\n      '> Build directory is not writeable. https://err.sh/vercel/next.js/build-dir-not-writeable'\n    )\n  }\n\n  // attempt to load global env values so they are available in next.config.js\n  const { loadedEnvFiles } = loadEnvConfig(dir)\n\n  const config = loadConfig(PHASE_PRODUCTION_BUILD, dir, conf)\n  const { target } = config\n  const buildId = await generateBuildId(config.generateBuildId, nanoid)\n  const distDir = path.join(dir, config.distDir)\n  const headers: Header[] = []\n  const rewrites: Rewrite[] = []\n  const redirects: Redirect[] = []\n\n  if (typeof config.experimental.redirects === 'function') {\n    const _redirects = await config.experimental.redirects()\n    checkCustomRoutes(_redirects, 'redirect')\n    redirects.push(..._redirects)\n  }\n  if (typeof config.experimental.rewrites === 'function') {\n    const _rewrites = await config.experimental.rewrites()\n    checkCustomRoutes(_rewrites, 'rewrite')\n    rewrites.push(..._rewrites)\n  }\n  if (typeof config.experimental.headers === 'function') {\n    const _headers = await config.experimental.headers()\n    checkCustomRoutes(_headers, 'header')\n    headers.push(..._headers)\n  }\n\n  if (ciEnvironment.isCI && !ciEnvironment.hasNextSupport) {\n    const cacheDir = path.join(distDir, 'cache')\n    const hasCache = await promises\n      .access(cacheDir)\n      .then(() => true)\n      .catch(() => false)\n\n    if (!hasCache) {\n      // Intentionally not piping to stderr in case people fail in CI when\n      // stderr is detected.\n      console.log(\n        chalk.bold.yellow(`Warning: `) +\n          chalk.bold(\n            `No build cache found. Please configure build caching for faster rebuilds. Read more: https://err.sh/next.js/no-cache`\n          )\n      )\n      console.log('')\n    }\n  }\n\n  const buildSpinner = createSpinner({\n    prefixText: 'Creating an optimized production build',\n  })\n\n  const telemetry = new Telemetry({ distDir })\n\n  const publicDir = path.join(dir, 'public')\n  const pagesDir = findPagesDir(dir)\n  let publicFiles: string[] = []\n  let hasPublicDir = false\n\n  telemetry.record(\n    eventCliSession(PHASE_PRODUCTION_BUILD, dir, {\n      cliCommand: 'build',\n      isSrcDir: path.relative(dir, pagesDir!).startsWith('src'),\n      hasNowJson: !!(await findUp('now.json', { cwd: dir })),\n      isCustomServer: null,\n    })\n  )\n\n  eventNextPlugins(path.resolve(dir)).then((events) => telemetry.record(events))\n\n  await verifyTypeScriptSetup(dir, pagesDir)\n\n  try {\n    await promises.stat(publicDir)\n    hasPublicDir = true\n  } catch (_) {}\n\n  if (hasPublicDir) {\n    publicFiles = await recursiveReadDir(publicDir, /.*/)\n  }\n\n  let tracer: any = null\n  if (config.experimental.profiling) {\n    const { createTrace } = require('./profiler/profiler.js')\n    tracer = createTrace(path.join(distDir, `profile-events.json`))\n    tracer.profiler.startProfiling()\n  }\n\n  const isLikeServerless = isTargetLikeServerless(target)\n\n  const pagePaths: string[] = await collectPages(\n    pagesDir,\n    config.pageExtensions\n  )\n\n  // needed for static exporting since we want to replace with HTML\n  // files\n  const allStaticPages = new Set<string>()\n  let allPageInfos = new Map<string, PageInfo>()\n\n  const previewProps: __ApiPreviewProps = {\n    previewModeId: crypto.randomBytes(16).toString('hex'),\n    previewModeSigningKey: crypto.randomBytes(32).toString('hex'),\n    previewModeEncryptionKey: crypto.randomBytes(32).toString('hex'),\n  }\n\n  const mappedPages = createPagesMapping(pagePaths, config.pageExtensions)\n  const entrypoints = createEntrypoints(\n    /* dev */ false,\n    mappedPages,\n    target,\n    buildId,\n    previewProps,\n    config,\n    loadedEnvFiles\n  )\n  const pageKeys = Object.keys(mappedPages)\n  const conflictingPublicFiles: string[] = []\n  const hasCustomErrorPage = mappedPages['/_error'].startsWith(\n    'private-next-pages'\n  )\n  const hasPages404 = Boolean(\n    mappedPages['/404'] && mappedPages['/404'].startsWith('private-next-pages')\n  )\n  let hasNonStaticErrorPage: boolean\n\n  if (hasPublicDir) {\n    try {\n      await promises.stat(path.join(publicDir, '_next'))\n      throw new Error(PUBLIC_DIR_MIDDLEWARE_CONFLICT)\n    } catch (err) {}\n  }\n\n  for (let file of publicFiles) {\n    file = file\n      .replace(/\\\\/g, '/')\n      .replace(/\\/index$/, '')\n      .split(publicDir)\n      .pop()!\n\n    if (mappedPages[file]) {\n      conflictingPublicFiles.push(file)\n    }\n  }\n  const numConflicting = conflictingPublicFiles.length\n\n  if (numConflicting) {\n    throw new Error(\n      `Conflicting public and page file${\n        numConflicting === 1 ? ' was' : 's were'\n      } found. https://err.sh/vercel/next.js/conflicting-public-file-page\\n${conflictingPublicFiles.join(\n        '\\n'\n      )}`\n    )\n  }\n\n  const nestedReservedPages = pageKeys.filter((page) => {\n    return (\n      page.match(/\\/(_app|_document|_error)$/) && path.dirname(page) !== '/'\n    )\n  })\n\n  if (nestedReservedPages.length) {\n    console.warn(\n      '\\n' +\n        chalk.bold.yellow(`Warning: `) +\n        chalk.bold(\n          `The following reserved Next.js pages were detected not directly under the pages directory:\\n`\n        ) +\n        nestedReservedPages.join('\\n') +\n        chalk.bold(\n          `\\nSee more info here: https://err.sh/next.js/nested-reserved-page\\n`\n        )\n    )\n  }\n\n  const buildCustomRoute = (\n    r: {\n      source: string\n      statusCode?: number\n    },\n    type: RouteType\n  ) => {\n    const keys: any[] = []\n    const routeRegex = pathToRegexp(r.source, keys, {\n      strict: true,\n      sensitive: false,\n      delimiter: '/', // default is `/#?`, but Next does not pass query info\n    })\n\n    return {\n      ...r,\n      ...(type === 'redirect'\n        ? {\n            statusCode: getRedirectStatus(r as Redirect),\n            permanent: undefined,\n          }\n        : {}),\n      regex: routeRegex.source,\n    }\n  }\n\n  const firstOptionalCatchAllPage =\n    pageKeys.find((f) => /\\[\\[\\.{3}[^\\][/]*\\]\\]/.test(f)) ?? null\n  if (\n    config.experimental?.optionalCatchAll !== true &&\n    firstOptionalCatchAllPage\n  ) {\n    const msg = `Optional catch-all routes are currently experimental and cannot be used by default (\"${firstOptionalCatchAllPage}\").`\n    throw new Error(msg)\n  }\n\n  const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n  const routesManifest: any = {\n    version: 1,\n    pages404: true,\n    basePath: config.experimental.basePath,\n    redirects: redirects.map((r) => buildCustomRoute(r, 'redirect')),\n    rewrites: rewrites.map((r) => buildCustomRoute(r, 'rewrite')),\n    headers: headers.map((r) => buildCustomRoute(r, 'header')),\n    dynamicRoutes: getSortedRoutes(pageKeys)\n      .filter(isDynamicRoute)\n      .map((page) => {\n        const routeRegex = getRouteRegex(page)\n        return {\n          page,\n          regex: routeRegex.re.source,\n          namedRegex: routeRegex.namedRegex,\n          routeKeys: Object.keys(routeRegex.groups),\n        }\n      }),\n  }\n\n  await promises.mkdir(distDir, { recursive: true })\n  // We need to write the manifest with rewrites before build\n  // so serverless can import the manifest\n  await promises.writeFile(\n    routesManifestPath,\n    JSON.stringify(routesManifest),\n    'utf8'\n  )\n\n  const configs = await Promise.all([\n    getBaseWebpackConfig(dir, {\n      tracer,\n      buildId,\n      isServer: false,\n      config,\n      target,\n      pagesDir,\n      entrypoints: entrypoints.client,\n    }),\n    getBaseWebpackConfig(dir, {\n      tracer,\n      buildId,\n      isServer: true,\n      config,\n      target,\n      pagesDir,\n      entrypoints: entrypoints.server,\n    }),\n  ])\n\n  const clientConfig = configs[0]\n\n  if (\n    clientConfig.optimization &&\n    (clientConfig.optimization.minimize !== true ||\n      (clientConfig.optimization.minimizer &&\n        clientConfig.optimization.minimizer.length === 0))\n  ) {\n    console.warn(\n      chalk.bold.yellow(`Warning: `) +\n        chalk.bold(\n          `Production code optimization has been disabled in your project. Read more: https://err.sh/vercel/next.js/minification-disabled`\n        )\n    )\n  }\n\n  const webpackBuildStart = process.hrtime()\n\n  let result: CompilerResult = { warnings: [], errors: [] }\n  // TODO: why do we need this?? https://github.com/vercel/next.js/issues/8253\n  if (isLikeServerless) {\n    const clientResult = await runCompiler(clientConfig)\n    // Fail build if clientResult contains errors\n    if (clientResult.errors.length > 0) {\n      result = {\n        warnings: [...clientResult.warnings],\n        errors: [...clientResult.errors],\n      }\n    } else {\n      const serverResult = await runCompiler(configs[1])\n      result = {\n        warnings: [...clientResult.warnings, ...serverResult.warnings],\n        errors: [...clientResult.errors, ...serverResult.errors],\n      }\n    }\n  } else {\n    result = await runCompiler(configs)\n  }\n\n  const webpackBuildEnd = process.hrtime(webpackBuildStart)\n  if (buildSpinner) {\n    buildSpinner.stopAndPersist()\n  }\n  console.log()\n\n  result = formatWebpackMessages(result)\n\n  if (result.errors.length > 0) {\n    // Only keep the first error. Others are often indicative\n    // of the same problem, but confuse the reader with noise.\n    if (result.errors.length > 1) {\n      result.errors.length = 1\n    }\n    const error = result.errors.join('\\n\\n')\n\n    console.error(chalk.red('Failed to compile.\\n'))\n\n    if (\n      error.indexOf('private-next-pages') > -1 &&\n      error.indexOf('does not contain a default export') > -1\n    ) {\n      const page_name_regex = /'private-next-pages\\/(?<page_name>[^']*)'/\n      const parsed = page_name_regex.exec(error)\n      const page_name = parsed && parsed.groups && parsed.groups.page_name\n      throw new Error(\n        `webpack build failed: found page without a React Component as default export in pages/${page_name}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.`\n      )\n    }\n\n    console.error(error)\n    console.error()\n\n    if (\n      error.indexOf('private-next-pages') > -1 ||\n      error.indexOf('__next_polyfill__') > -1\n    ) {\n      throw new Error(\n        '> webpack config.resolve.alias was incorrectly overriden. https://err.sh/vercel/next.js/invalid-resolve-alias'\n      )\n    }\n    throw new Error('> Build failed because of webpack errors')\n  } else {\n    telemetry.record(\n      eventBuildCompleted(pagePaths, {\n        durationInSeconds: webpackBuildEnd[0],\n      })\n    )\n\n    if (result.warnings.length > 0) {\n      console.warn(chalk.yellow('Compiled with warnings.\\n'))\n      console.warn(result.warnings.join('\\n\\n'))\n      console.warn()\n    } else {\n      console.log(chalk.green('Compiled successfully.\\n'))\n    }\n  }\n  const postBuildSpinner = createSpinner({\n    prefixText: 'Automatically optimizing pages',\n  })\n\n  const manifestPath = path.join(\n    distDir,\n    isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n    PAGES_MANIFEST\n  )\n  const buildManifestPath = path.join(distDir, BUILD_MANIFEST)\n\n  const ssgPages = new Set<string>()\n  const ssgFallbackPages = new Set<string>()\n  const staticPages = new Set<string>()\n  const invalidPages = new Set<string>()\n  const hybridAmpPages = new Set<string>()\n  const serverPropsPages = new Set<string>()\n  const additionalSsgPaths = new Map<string, Array<string>>()\n  const pageInfos = new Map<string, PageInfo>()\n  const pagesManifest = JSON.parse(\n    await promises.readFile(manifestPath, 'utf8')\n  ) as PagesManifest\n  const buildManifest = JSON.parse(\n    await promises.readFile(buildManifestPath, 'utf8')\n  ) as BuildManifest\n\n  let customAppGetInitialProps: boolean | undefined\n  let namedExports: Array<string> | undefined\n\n  process.env.NEXT_PHASE = PHASE_PRODUCTION_BUILD\n\n  const staticCheckWorkers = new Worker(staticCheckWorker, {\n    numWorkers: config.experimental.cpus,\n    enableWorkerThreads: config.experimental.workerThreads,\n  }) as Worker & { isPageStatic: typeof isPageStatic }\n\n  staticCheckWorkers.getStdout().pipe(process.stdout)\n  staticCheckWorkers.getStderr().pipe(process.stderr)\n\n  const runtimeEnvConfig = {\n    publicRuntimeConfig: config.publicRuntimeConfig,\n    serverRuntimeConfig: config.serverRuntimeConfig,\n  }\n\n  hasNonStaticErrorPage =\n    hasCustomErrorPage &&\n    (await hasCustomGetInitialProps(\n      path.join(\n        distDir,\n        ...(isLikeServerless\n          ? ['serverless', 'pages']\n          : ['server', 'static', buildId, 'pages']),\n        '_error.js'\n      ),\n      runtimeEnvConfig,\n      false\n    ))\n\n  const analysisBegin = process.hrtime()\n  await Promise.all(\n    pageKeys.map(async (page) => {\n      const actualPage = normalizePagePath(page)\n      const [selfSize, allSize] = await getJsPageSizeInKb(\n        actualPage,\n        distDir,\n        buildId,\n        buildManifest,\n        config.experimental.modern\n      )\n      const bundleRelative = path.join(\n        isLikeServerless ? 'pages' : `static/${buildId}/pages`,\n        actualPage + '.js'\n      )\n      const serverBundle = path.join(\n        distDir,\n        isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n        bundleRelative\n      )\n\n      let isSsg = false\n      let isStatic = false\n      let isHybridAmp = false\n      let ssgPageRoutes: string[] | null = null\n      let hasSsgFallback: boolean = false\n\n      pagesManifest[page] = bundleRelative.replace(/\\\\/g, '/')\n\n      const nonReservedPage = !page.match(/^\\/(_app|_error|_document|api)/)\n\n      if (nonReservedPage && customAppGetInitialProps === undefined) {\n        customAppGetInitialProps = hasCustomGetInitialProps(\n          isLikeServerless\n            ? serverBundle\n            : path.join(\n                distDir,\n                SERVER_DIRECTORY,\n                `/static/${buildId}/pages/_app.js`\n              ),\n          runtimeEnvConfig,\n          true\n        )\n\n        namedExports = getNamedExports(\n          isLikeServerless\n            ? serverBundle\n            : path.join(\n                distDir,\n                SERVER_DIRECTORY,\n                `/static/${buildId}/pages/_app.js`\n              ),\n          runtimeEnvConfig\n        )\n\n        if (customAppGetInitialProps) {\n          console.warn(\n            chalk.bold.yellow(`Warning: `) +\n              chalk.yellow(\n                `You have opted-out of Automatic Static Optimization due to \\`getInitialProps\\` in \\`pages/_app\\`. This does not opt-out pages with \\`getStaticProps\\``\n              )\n          )\n          console.warn(\n            'Read more: https://err.sh/next.js/opt-out-auto-static-optimization\\n'\n          )\n        }\n      }\n\n      if (nonReservedPage) {\n        try {\n          let result = await staticCheckWorkers.isPageStatic(\n            page,\n            serverBundle,\n            runtimeEnvConfig\n          )\n\n          if (result.isHybridAmp) {\n            isHybridAmp = true\n            hybridAmpPages.add(page)\n          }\n\n          if (result.isAmpOnly) {\n            // ensure all AMP only bundles got removed\n            try {\n              const clientBundle = path.join(\n                distDir,\n                'static',\n                buildId,\n                'pages',\n                actualPage + '.js'\n              )\n              await promises.unlink(clientBundle)\n\n              if (config.experimental.modern) {\n                await promises.unlink(\n                  clientBundle.replace(/\\.js$/, '.module.js')\n                )\n              }\n            } catch (err) {\n              if (err.code !== 'ENOENT') {\n                throw err\n              }\n            }\n          }\n\n          if (result.hasStaticProps) {\n            ssgPages.add(page)\n            isSsg = true\n\n            if (result.prerenderRoutes) {\n              additionalSsgPaths.set(page, result.prerenderRoutes)\n              ssgPageRoutes = result.prerenderRoutes\n            }\n            if (result.prerenderFallback) {\n              hasSsgFallback = true\n              ssgFallbackPages.add(page)\n            }\n          } else if (result.hasServerProps) {\n            serverPropsPages.add(page)\n          } else if (result.isStatic && customAppGetInitialProps === false) {\n            staticPages.add(page)\n            isStatic = true\n          }\n\n          if (hasPages404 && page === '/404') {\n            if (!result.isStatic && !result.hasStaticProps) {\n              throw new Error(PAGES_404_GET_INITIAL_PROPS_ERROR)\n            }\n            // we need to ensure the 404 lambda is present since we use\n            // it when _app has getInitialProps\n            if (customAppGetInitialProps && !result.hasStaticProps) {\n              staticPages.delete(page)\n            }\n          }\n        } catch (err) {\n          if (err.message !== 'INVALID_DEFAULT_EXPORT') throw err\n          invalidPages.add(page)\n        }\n      }\n\n      pageInfos.set(page, {\n        size: selfSize,\n        totalSize: allSize,\n        serverBundle,\n        static: isStatic,\n        isSsg,\n        isHybridAmp,\n        ssgPageRoutes,\n        hasSsgFallback,\n      })\n    })\n  )\n  staticCheckWorkers.end()\n\n  if (serverPropsPages.size > 0 || ssgPages.size > 0) {\n    // We update the routes manifest after the build with the\n    // data routes since we can't determine these until after build\n    routesManifest.dataRoutes = getSortedRoutes([\n      ...serverPropsPages,\n      ...ssgPages,\n    ]).map((page) => {\n      const pagePath = normalizePagePath(page)\n      const dataRoute = path.posix.join(\n        '/_next/data',\n        buildId,\n        `${pagePath}.json`\n      )\n\n      let dataRouteRegex: string\n      let routeKeys: string[] | undefined\n      let namedDataRouteRegex: string | undefined\n\n      if (isDynamicRoute(page)) {\n        const routeRegex = getRouteRegex(dataRoute.replace(/\\.json$/, ''))\n\n        dataRouteRegex = routeRegex.re.source.replace(\n          /\\(\\?:\\\\\\/\\)\\?\\$$/,\n          '\\\\.json$'\n        )\n        namedDataRouteRegex = routeRegex.namedRegex!.replace(\n          /\\(\\?:\\/\\)\\?\\$$/,\n          '\\\\.json$'\n        )\n        routeKeys = Object.keys(routeRegex.groups)\n      } else {\n        dataRouteRegex = new RegExp(\n          `^${path.posix.join(\n            '/_next/data',\n            escapeStringRegexp(buildId),\n            `${pagePath}.json`\n          )}$`\n        ).source\n      }\n\n      return {\n        page,\n        routeKeys,\n        dataRouteRegex,\n        namedDataRouteRegex,\n      }\n    })\n\n    await promises.writeFile(\n      routesManifestPath,\n      JSON.stringify(routesManifest),\n      'utf8'\n    )\n  }\n  // Since custom _app.js can wrap the 404 page we have to opt-out of static optimization if it has getInitialProps\n  // Only export the static 404 when there is no /_error present\n  const useStatic404 =\n    !customAppGetInitialProps && (!hasNonStaticErrorPage || hasPages404)\n\n  if (invalidPages.size > 0) {\n    throw new Error(\n      `Build optimization failed: found page${\n        invalidPages.size === 1 ? '' : 's'\n      } without a React Component as default export in \\n${[...invalidPages]\n        .map((pg) => `pages${pg}`)\n        .join(\n          '\\n'\n        )}\\n\\nSee https://err.sh/vercel/next.js/page-without-valid-component for more info.\\n`\n    )\n  }\n\n  if (Array.isArray(configs[0].plugins)) {\n    configs[0].plugins.some((plugin: any) => {\n      if (!plugin.ampPages) {\n        return false\n      }\n\n      plugin.ampPages.forEach((pg: any) => {\n        pageInfos.get(pg)!.isAmp = true\n      })\n      return true\n    })\n  }\n\n  await writeBuildId(distDir, buildId)\n\n  const finalPrerenderRoutes: { [route: string]: SsgRoute } = {}\n  const tbdPrerenderRoutes: string[] = []\n\n  if (staticPages.size > 0 || ssgPages.size > 0 || useStatic404) {\n    const combinedPages = [...staticPages, ...ssgPages]\n    const exportApp = require('../export').default\n    const exportOptions = {\n      silent: true,\n      buildExport: true,\n      threads: config.experimental.cpus,\n      pages: combinedPages,\n      outdir: path.join(distDir, 'export'),\n    }\n    const exportConfig: any = {\n      ...config,\n      initialPageRevalidationMap: {},\n      // Default map will be the collection of automatic statically exported\n      // pages and SPR pages.\n      // n.b. we cannot handle this above in combinedPages because the dynamic\n      // page must be in the `pages` array, but not in the mapping.\n      exportPathMap: (defaultMap: any) => {\n        // Dynamically routed pages should be prerendered to be used as\n        // a client-side skeleton (fallback) while data is being fetched.\n        // This ensures the end-user never sees a 500 or slow response from the\n        // server.\n        //\n        // Note: prerendering disables automatic static optimization.\n        ssgPages.forEach((page) => {\n          if (isDynamicRoute(page)) {\n            tbdPrerenderRoutes.push(page)\n\n            if (ssgFallbackPages.has(page)) {\n              // Override the rendering for the dynamic page to be treated as a\n              // fallback render.\n              defaultMap[page] = { page, query: { __nextFallback: true } }\n            } else {\n              // Remove dynamically routed pages from the default path map when\n              // fallback behavior is disabled.\n              delete defaultMap[page]\n            }\n          }\n        })\n        // Append the \"well-known\" routes we should prerender for, e.g. blog\n        // post slugs.\n        additionalSsgPaths.forEach((routes, page) => {\n          routes.forEach((route) => {\n            defaultMap[route] = { page }\n          })\n        })\n\n        if (useStatic404) {\n          defaultMap['/404'] = {\n            page: hasPages404 ? '/404' : '/_error',\n          }\n        }\n\n        return defaultMap\n      },\n      exportTrailingSlash: false,\n    }\n\n    await exportApp(dir, exportOptions, exportConfig)\n\n    // remove server bundles that were exported\n    for (const page of staticPages) {\n      const { serverBundle } = pageInfos.get(page)!\n      await promises.unlink(serverBundle)\n    }\n\n    const moveExportedPage = async (\n      page: string,\n      file: string,\n      isSsg: boolean,\n      ext: 'html' | 'json'\n    ) => {\n      file = `${file}.${ext}`\n      const orig = path.join(exportOptions.outdir, file)\n      const relativeDest = (isLikeServerless\n        ? path.join('pages', file)\n        : path.join('static', buildId, 'pages', file)\n      ).replace(/\\\\/g, '/')\n\n      const dest = path.join(\n        distDir,\n        isLikeServerless ? SERVERLESS_DIRECTORY : SERVER_DIRECTORY,\n        relativeDest\n      )\n\n      if (!isSsg) {\n        pagesManifest[page] = relativeDest\n        if (page === '/') pagesManifest['/index'] = relativeDest\n        if (page === '/.amp') pagesManifest['/index.amp'] = relativeDest\n      }\n      await promises.mkdir(path.dirname(dest), { recursive: true })\n      await promises.rename(orig, dest)\n    }\n\n    // Only move /404 to /404 when there is no custom 404 as in that case we don't know about the 404 page\n    if (!hasPages404 && useStatic404) {\n      await moveExportedPage('/404', '/404', false, 'html')\n    }\n\n    for (const page of combinedPages) {\n      const isSsg = ssgPages.has(page)\n      const isSsgFallback = ssgFallbackPages.has(page)\n      const isDynamic = isDynamicRoute(page)\n      const hasAmp = hybridAmpPages.has(page)\n      let file = normalizePagePath(page)\n\n      // The dynamic version of SSG pages are only prerendered if the fallback\n      // is enabled. Below, we handle the specific prerenders of these.\n      if (!(isSsg && isDynamic && !isSsgFallback)) {\n        await moveExportedPage(page, file, isSsg, 'html')\n      }\n\n      if (hasAmp && (!isSsg || (isSsg && !isDynamic))) {\n        await moveExportedPage(`${page}.amp`, `${file}.amp`, isSsg, 'html')\n\n        if (isSsg) {\n          await moveExportedPage(`${page}.amp`, `${file}.amp`, isSsg, 'json')\n        }\n      }\n\n      if (isSsg) {\n        // For a non-dynamic SSG page, we must copy its data file from export.\n        if (!isDynamic) {\n          await moveExportedPage(page, file, true, 'json')\n\n          finalPrerenderRoutes[page] = {\n            initialRevalidateSeconds:\n              exportConfig.initialPageRevalidationMap[page],\n            srcRoute: null,\n            dataRoute: path.posix.join('/_next/data', buildId, `${file}.json`),\n          }\n        } else {\n          // For a dynamic SSG page, we did not copy its data exports and only\n          // copy the fallback HTML file (if present).\n          // We must also copy specific versions of this page as defined by\n          // `getStaticPaths` (additionalSsgPaths).\n          const extraRoutes = additionalSsgPaths.get(page) || []\n          for (const route of extraRoutes) {\n            await moveExportedPage(route, route, true, 'html')\n            await moveExportedPage(route, route, true, 'json')\n\n            if (hasAmp) {\n              await moveExportedPage(\n                `${route}.amp`,\n                `${route}.amp`,\n                true,\n                'html'\n              )\n              await moveExportedPage(\n                `${route}.amp`,\n                `${route}.amp`,\n                true,\n                'json'\n              )\n            }\n\n            finalPrerenderRoutes[route] = {\n              initialRevalidateSeconds:\n                exportConfig.initialPageRevalidationMap[route],\n              srcRoute: page,\n              dataRoute: path.posix.join(\n                '/_next/data',\n                buildId,\n                `${normalizePagePath(route)}.json`\n              ),\n            }\n          }\n        }\n      }\n    }\n\n    // remove temporary export folder\n    await recursiveDelete(exportOptions.outdir)\n    await promises.rmdir(exportOptions.outdir)\n    await promises.writeFile(\n      manifestPath,\n      JSON.stringify(pagesManifest),\n      'utf8'\n    )\n  }\n\n  if (postBuildSpinner) postBuildSpinner.stopAndPersist()\n  console.log()\n\n  const analysisEnd = process.hrtime(analysisBegin)\n  telemetry.record(\n    eventBuildOptimize(pagePaths, {\n      durationInSeconds: analysisEnd[0],\n      staticPageCount: staticPages.size,\n      staticPropsPageCount: ssgPages.size,\n      serverPropsPageCount: serverPropsPages.size,\n      ssrPageCount:\n        pagePaths.length -\n        (staticPages.size + ssgPages.size + serverPropsPages.size),\n      hasStatic404: useStatic404,\n      hasReportWebVitals: namedExports?.includes('reportWebVitals') ?? false,\n    })\n  )\n\n  if (ssgPages.size > 0) {\n    const finalDynamicRoutes: PrerenderManifest['dynamicRoutes'] = {}\n    tbdPrerenderRoutes.forEach((tbdRoute) => {\n      const normalizedRoute = normalizePagePath(tbdRoute)\n      const dataRoute = path.posix.join(\n        '/_next/data',\n        buildId,\n        `${normalizedRoute}.json`\n      )\n\n      finalDynamicRoutes[tbdRoute] = {\n        routeRegex: getRouteRegex(tbdRoute).re.source,\n        dataRoute,\n        fallback: ssgFallbackPages.has(tbdRoute)\n          ? `${normalizedRoute}.html`\n          : false,\n        dataRouteRegex: getRouteRegex(\n          dataRoute.replace(/\\.json$/, '')\n        ).re.source.replace(/\\(\\?:\\\\\\/\\)\\?\\$$/, '\\\\.json$'),\n      }\n    })\n    const prerenderManifest: PrerenderManifest = {\n      version: 2,\n      routes: finalPrerenderRoutes,\n      dynamicRoutes: finalDynamicRoutes,\n      preview: previewProps,\n    }\n\n    await promises.writeFile(\n      path.join(distDir, PRERENDER_MANIFEST),\n      JSON.stringify(prerenderManifest),\n      'utf8'\n    )\n    await generateClientSsgManifest(prerenderManifest, {\n      distDir,\n      buildId,\n      isModern: !!config.experimental.modern,\n    })\n  } else {\n    const prerenderManifest: PrerenderManifest = {\n      version: 2,\n      routes: {},\n      dynamicRoutes: {},\n      preview: previewProps,\n    }\n    await promises.writeFile(\n      path.join(distDir, PRERENDER_MANIFEST),\n      JSON.stringify(prerenderManifest),\n      'utf8'\n    )\n    // No need to call this fn as we already emitted a default SSG manifest:\n    // await generateClientSsgManifest(prerenderManifest, { distDir, buildId })\n  }\n\n  await promises.writeFile(\n    path.join(distDir, EXPORT_MARKER),\n    JSON.stringify({\n      version: 1,\n      hasExportPathMap: typeof config.exportPathMap === 'function',\n      exportTrailingSlash: config.exportTrailingSlash === true,\n    }),\n    'utf8'\n  )\n  await promises.unlink(path.join(distDir, EXPORT_DETAIL)).catch((err) => {\n    if (err.code === 'ENOENT') {\n      return Promise.resolve()\n    }\n    return Promise.reject(err)\n  })\n\n  staticPages.forEach((pg) => allStaticPages.add(pg))\n  pageInfos.forEach((info: PageInfo, key: string) => {\n    allPageInfos.set(key, info)\n  })\n\n  await printTreeView(\n    Object.keys(mappedPages),\n    allPageInfos,\n    isLikeServerless,\n    {\n      distPath: distDir,\n      buildId: buildId,\n      pagesDir,\n      useStatic404,\n      pageExtensions: config.pageExtensions,\n      buildManifest,\n      isModern: config.experimental.modern,\n    }\n  )\n  printCustomRoutes({ redirects, rewrites, headers })\n\n  if (tracer) {\n    const parsedResults = await tracer.profiler.stopProfiling()\n    await new Promise((resolve) => {\n      if (parsedResults === undefined) {\n        tracer.profiler.destroy()\n        tracer.trace.flush()\n        tracer.end(resolve)\n        return\n      }\n\n      const cpuStartTime = parsedResults.profile.startTime\n      const cpuEndTime = parsedResults.profile.endTime\n\n      tracer.trace.completeEvent({\n        name: 'TaskQueueManager::ProcessTaskFromWorkQueue',\n        id: ++tracer.counter,\n        cat: ['toplevel'],\n        ts: cpuStartTime,\n        args: {\n          src_file: '../../ipc/ipc_moji_bootstrap.cc',\n          src_func: 'Accept',\n        },\n      })\n\n      tracer.trace.completeEvent({\n        name: 'EvaluateScript',\n        id: ++tracer.counter,\n        cat: ['devtools.timeline'],\n        ts: cpuStartTime,\n        dur: cpuEndTime - cpuStartTime,\n        args: {\n          data: {\n            url: 'webpack',\n            lineNumber: 1,\n            columnNumber: 1,\n            frame: '0xFFF',\n          },\n        },\n      })\n\n      tracer.trace.instantEvent({\n        name: 'CpuProfile',\n        id: ++tracer.counter,\n        cat: ['disabled-by-default-devtools.timeline'],\n        ts: cpuEndTime,\n        args: {\n          data: {\n            cpuProfile: parsedResults.profile,\n          },\n        },\n      })\n\n      tracer.profiler.destroy()\n      tracer.trace.flush()\n      tracer.end(resolve)\n    })\n  }\n\n  await telemetry.flush()\n}\n\nfunction generateClientSsgManifest(\n  prerenderManifest: PrerenderManifest,\n  {\n    buildId,\n    distDir,\n    isModern,\n  }: { buildId: string; distDir: string; isModern: boolean }\n) {\n  const ssgPages: Set<string> = new Set<string>([\n    ...Object.entries(prerenderManifest.routes)\n      // Filter out dynamic routes\n      .filter(([, { srcRoute }]) => srcRoute == null)\n      .map(([route]) => route),\n    ...Object.keys(prerenderManifest.dynamicRoutes),\n  ])\n\n  const clientSsgManifestPaths = [\n    '_ssgManifest.js',\n    isModern && '_ssgManifest.module.js',\n  ]\n    .filter(Boolean)\n    .map((f) =>\n      path.join(`${CLIENT_STATIC_FILES_PATH}/${buildId}`, f as string)\n    )\n  const clientSsgManifestContent = `self.__SSG_MANIFEST=${devalue(\n    ssgPages\n  )};self.__SSG_MANIFEST_CB&&self.__SSG_MANIFEST_CB()`\n  clientSsgManifestPaths.forEach((clientSsgManifestPath) =>\n    writeFileSync(\n      path.join(distDir, clientSsgManifestPath),\n      clientSsgManifestContent\n    )\n  )\n}\n"]}