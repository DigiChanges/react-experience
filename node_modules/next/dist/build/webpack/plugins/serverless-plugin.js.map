{"version":3,"sources":["../../../../build/webpack/plugins/serverless-plugin.ts"],"names":["ServerlessPlugin","apply","compiler","hooks","compilation","tap","optimizeChunksBasic","chunks","forEach","chunk","hasEntryModule","dynamicChunks","getAllAsyncChunks","size","dynamicChunk","module","modulesIterable"],"mappings":"qEACA,sDAEA;;;;GAMO,KAAMA,CAAAA,gBAAiB,CAC5BC,KAAK,CAACC,QAAD,CAAqB,CACxBA,QAAQ,CAACC,KAAT,CAAeC,WAAf,CAA2BC,GAA3B,CAA+B,kBAA/B,CAAoDD,WAAD,EAAiB,CAClEA,WAAW,CAACD,KAAZ,CAAkBG,mBAAlB,CAAsCD,GAAtC,CACE,kBADF,CAEGE,MAAD,EAAY,CACVA,MAAM,CAACC,OAAP,CAAgBC,KAAD,EAAW,CACxB;AACA,GAAIA,KAAK,CAACC,cAAN,EAAJ,CAA4B,CAC1B,KAAMC,CAAAA,aAAa,CAAGF,KAAK,CAACG,iBAAN,EAAtB,CACA,GAAID,aAAa,CAACE,IAAd,GAAuB,CAA3B,CAA8B,CAC5B,IAAK,KAAMC,CAAAA,YAAX,GAA2BH,CAAAA,aAA3B,CAA0C,CACxC,IAAK,KAAMI,CAAAA,MAAX,GAAqBD,CAAAA,YAAY,CAACE,eAAlC,CAAmD,CACjD,wCAAsBP,KAAtB,CAA6BM,MAA7B,EACD,CACF,CACF,CACF,CACF,CAZD,EAaD,CAhBH,EAkBD,CAnBD,EAoBD,CAtB2B,C","sourcesContent":["import { Compiler } from 'webpack'\nimport { connectChunkAndModule } from 'webpack/lib/GraphHelpers'\n\n/**\n * Makes sure there are no dynamic chunks when the target is serverless\n * The dynamic chunks are integrated back into their parent chunk\n * This is to make sure there is a single render bundle instead of that bundle importing dynamic chunks\n */\n\nexport class ServerlessPlugin {\n  apply(compiler: Compiler) {\n    compiler.hooks.compilation.tap('ServerlessPlugin', (compilation) => {\n      compilation.hooks.optimizeChunksBasic.tap(\n        'ServerlessPlugin',\n        (chunks) => {\n          chunks.forEach((chunk) => {\n            // If chunk is not an entry point skip them\n            if (chunk.hasEntryModule()) {\n              const dynamicChunks = chunk.getAllAsyncChunks()\n              if (dynamicChunks.size !== 0) {\n                for (const dynamicChunk of dynamicChunks) {\n                  for (const module of dynamicChunk.modulesIterable) {\n                    connectChunkAndModule(chunk, module)\n                  }\n                }\n              }\n            }\n          })\n        }\n      )\n    })\n  }\n}\n"]}